$NetBSD$

--- imap/message.c.orig	Fri Feb 27 18:44:55 2004
+++ imap/message.c	Sun Oct 17 15:38:34 2004
@@ -285,7 +285,9 @@
     /* Go back and check headers */
     sawnl = 1;
     for (;;) {
-	if (!fgets(buf, sizeof(buf), to)) return IMAP_MESSAGE_NOBLANKLINE;
+	if (!fgets(buf, sizeof(buf), to)) {
+	    return sawnl ? 0 : IMAP_MESSAGE_BADHEADER;
+	}
 
 	/* End of header section */
 	if (sawnl && buf[0] == '\r') return 0;
